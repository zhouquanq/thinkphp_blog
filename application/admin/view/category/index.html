{include file="common/header" /}
<body>
<div class="x-nav">
      <span class="layui-breadcrumb">
          <a href="">首页</a>
          <a>
          <cite>导航元素</cite></a>
      </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>
<div class="x-body">
    <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so layui-form-pane">
            <input class="layui-input" placeholder="分类名" name="cate_name">
            <button class="layui-btn"  lay-submit="" lay-filter="sreach"><i class="layui-icon"></i>增加顶级分类</button>
        </form>
    </div>
    <!--<blockquote class="layui-elem-quote">每个tr 上有两个属性 cate-id='1' 当前分类id fid='0' 父级id ,顶级分类为 0，有子分类的前面加收缩图标<i class="layui-icon x-show" status='true'>&#xe623;</i></blockquote>-->
    <xblock>
        <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>
        <span class="x-right" style="line-height:40px">共有数据：{$count} 条</span>
    </xblock>
    <!-- 操作列 -->
    <table id="table1" class="layui-table" lay-filter="table1"></table>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-group">
            <!--<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="add"><i class="layui-icon layui-icon-add-1"></i> 增加</button>-->
            <!--<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i> 编辑</button>-->
            <!--<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i> 删除</button>-->
            <button class="layui-btn layui-btn-primary layui-btn-sm" id="btn-expand">全部展开</button>
            <button class="layui-btn layui-btn-primary layui-btn-sm" id="btn-fold">全部折叠</button>
        </div>
    </script>
    <script type="text/html" id="auth-state">
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="add">添加子分类</a>
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
</div>

<script>
    layui.config({
        base: '__SCRIPT__/'
    }).extend({
        treetable: 'treetable-lay/treetable'
    }).use(['layer', 'table', 'treetable','form','jquery'], function () {
        var $ = layui.jquery;
        var table = layui.table;
        var form = layui.form;
        // var element = layui.element;
        var layer = layui.layer;
        var treetable = layui.treetable;
        // 渲染表格
        var renderTable = function () {
            layer.load(2);
            treetable.render({
                treeColIndex: 2,
                treeSpid: 0,
                treeIdName: 'cid',
                treePidName: 'pid',
                treeDefaultClose: true,
                treeLinkage: false,
                elem: '#table1',
                url: "{:url('categoryData')}",
                toolbar:'#toolbarDemo',
                page: false,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'cid',  title: 'ID'},
                    {field: 'cname',  title: '名称'},
                    {field: 'csort',  align: 'center', title: '排序号'},
                    {field: 'is_show',  align: 'center', templet: function (d) {
                            if (d.is_show == 0) {
                                return '<span class="layui-badge layui-bg-red">隐藏</span>';
                            } else {
                                return '<span class="layui-badge-rim layui-bg-green">显示</span>';
                            }
                        }, title: '显隐状态'
                    },
                    {templet: '#auth-state',  align: 'center', title: '操作'}
                ]],
                done: function () {
                    layer.closeAll('loading');
                }
            });
        };
        renderTable();
        //全部展开
        $(document).on("click","#btn-expand",function(){
            treetable.expandAll('#table1');
        });
        //全部折叠
        $(document).on("click","#btn-fold",function(){
            treetable.foldAll('#table1');
        });

        //刷新表格
        $(document).on("click","#btn-refresh",function(){
            renderTable();
        });

        // //搜索
        // $(document).on("click","#btn-search",function(){
        //     var keyword = $('#edt-search').val();
        //     var searchCount = 0;
        //     $('#table1').next('.treeTable').find('.layui-table-body tbody tr td').each(function () {
        //         $(this).css('background-color', 'transparent');
        //         var text = $(this).text();
        //         if (keyword != '' && text.indexOf(keyword) >= 0) {
        //             $(this).css('background-color', 'rgba(250,230,160,0.5)');
        //             if (searchCount == 0) {
        //                 treetable.expandAll('#table1');
        //                 $('html,body').stop(true);
        //                 $('html,body').animate({scrollTop: $(this).offset().top - 150}, 500);
        //             }
        //             searchCount++;
        //         }
        //     });
        //     if (keyword == '') {
        //         layer.msg("请输入搜索内容", {icon: 5});
        //     } else if (searchCount == 0) {
        //         layer.msg("没有匹配结果", {icon: 5});
        //     }
        // });

        // //头工具栏事件
        // table.on('toolbar(table1)', function(obj){
        //     var checkStatus = table.checkStatus(obj.config.id);
        //
        //     switch(obj.event){
        //         case 'add':
        //             layer.ready(function(){
        //                 layer.open({
        //                     type: 2,
        //                     title: '增加',
        //                     maxmin: true,
        //                     area: ['80%', '70%'],
        //                     content: '{:url('add')}',
        //                     cancel: function(){ //刷新网页
        //                         //重新加载表格数据
        //                         self.location='{:url('index')}';
        //                     }
        //                 });
        //             });
        //             //layer.msg('增加' + obj.config.id);
        //             break;
        //         case 'edit':
        //             var data = checkStatus.data;
        //             var dataall = '';
        //             //data = JSON.stringify(data);
        //             //循环把所有要删除的ID整成12,13,545
        //             for(var i=0;i<data.length;i++){
        //                 dataall += data[i].id+",";
        //             }
        //             dataall=dataall.substring(0,dataall.length-1)
        //
        //             //         console.log(dataall)
        //             //         layer.alert(dataall);
        //             break;
        //         case 'del':
        //             var data = checkStatus.data;
        //             var dataall = '';
        //             //data = JSON.stringify(data);
        //             //循环把所有要删除的ID整成12,13,545
        //             for(var i=0;i<data.length;i++){
        //                 dataall += data[i].id+",";
        //             }
        //             dataall=dataall.substring(0,dataall.length-1)
        //
        //             //         console.log(dataall)
        //             layer.alert(dataall);
        //             break;
        //     };
        // });

        //监听工具条
        table.on('tool(table1)', function (obj) {
            var data = obj.data;
            console.log(data)
            var layEvent = obj.event;
            if (layEvent === 'del') {
                layer.msg('删除' + data.id);
            } else if (layEvent === 'edit') {
                layer.msg('修改' + data.id);
            }
        });


    });
</script>
</body>
</html>